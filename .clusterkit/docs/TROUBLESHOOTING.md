# ClusterKit Troubleshooting Guide

## Common Issues

### Services Not Accessible

**Symptom:** Cannot access service via domain

**Checks:**

1. Verify service is running:
   ```bash
   kubectl get ksvc -n default
   ```



2. Check ingress status:
   ```bash
   kubectl get ingress --all-namespaces
   ```



3. Verify DNS records in Cloudflare dashboard

4. Check ExternalDNS logs:
   ```bash
   kubectl logs -n external-dns -l app.kubernetes.io/name=external-dns
   ```



### TLS Certificate Issues

**Symptom:** Certificate errors when accessing services

**Checks:**

1. Check certificate status:
   ```bash
   kubectl get certificates --all-namespaces
   ```



2. View cert-manager logs:
   ```bash
   kubectl logs -n cert-manager -l app=cert-manager
   ```



3. Check ClusterIssuer:
   ```bash
   kubectl get clusterissuer letsencrypt-prod -o yaml
   ```



4. Verify domain ownership and DNS propagation

### Service Scaling Issues

**Symptom:** Service not scaling as expected

**Checks:**

1. Check Knative autoscaler:
   ```bash
   kubectl logs -n knative-serving -l app=autoscaler
   ```



2. Verify service configuration:
   ```bash
   kubectl get ksvc myapp -o yaml
   ```



3. Check metrics:
   ```bash
   kubectl top pods -n default
   ```



### DNS Not Updating

**Symptom:** DNS records not created or updated

**Checks:**

1. Verify ExternalDNS is running:
   ```bash
   kubectl get pods -n external-dns
   ```



2. Check ExternalDNS logs for errors:
   ```bash
   kubectl logs -n external-dns -l app.kubernetes.io/name=external-dns --tail=100
   ```



3. Verify Cloudflare API token permissions

4. Check ingress/service annotations:
   ```bash
   kubectl get ingress myapp -o yaml | grep external-dns
   ```



## Component Health Checks

### Knative Serving

```bash
# Check all Knative pods
kubectl get pods -n knative-serving

# Check Knative controller logs
kubectl logs -n knative-serving -l app=controller

# Verify webhook is working
kubectl get validatingwebhookconfigurations | grep knative
```



### NGINX Ingress

```bash
# Check ingress controller pods
kubectl get pods -n ingress-nginx

# View controller logs
kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller

# Check LoadBalancer status
kubectl get svc -n ingress-nginx ingress-nginx-controller
```



### cert-manager

```bash
# Check cert-manager pods
kubectl get pods -n cert-manager

# View cert-manager logs
kubectl logs -n cert-manager -l app=cert-manager

# Check webhook
kubectl get validatingwebhookconfigurations | grep cert-manager
```



### ExternalDNS

```bash
# Check ExternalDNS pods
kubectl get pods -n external-dns

# View logs
kubectl logs -n external-dns -l app.kubernetes.io/name=external-dns

# Check DNS records being managed
kubectl logs -n external-dns -l app.kubernetes.io/name=external-dns | grep "CREATE\|UPDATE\|DELETE"
```



## Debugging Commands

### Get All Resources

```bash
kubectl get all --all-namespaces
```



### Describe Resource

```bash
kubectl describe ksvc myapp -n default
kubectl describe pod pod-name -n namespace
```



### View Events

```bash
kubectl get events --all-namespaces --sort-by='.lastTimestamp'
```



### Check Resource Usage

```bash
kubectl top nodes
kubectl top pods --all-namespaces
```



## Recovery Procedures

### Restart a Component

```bash
# Restart Knative controller
kubectl rollout restart deployment controller -n knative-serving

# Restart Ingress controller
kubectl rollout restart deployment ingress-nginx-controller -n ingress-nginx

# Restart cert-manager
kubectl rollout restart deployment cert-manager -n cert-manager
```



### Force Certificate Renewal

```bash
kubectl delete certificate myapp-tls -n default
# Wait for cert-manager to recreate it
kubectl get certificate -n default -w
```



### Recreate Failed Service

```bash
# Export current configuration
kubectl get ksvc myapp -o yaml > myapp-backup.yaml

# Delete service
kubectl delete ksvc myapp

# Recreate from backup
kubectl apply -f myapp-backup.yaml
```



## Getting Help

If you continue to experience issues:

1. **Check GCP Status:** https://status.cloud.google.com/
2. **Check Cloudflare Status:** https://www.cloudflarestatus.com/
3. **Review Kubernetes Events:** Look for error messages in kubectl events
4. **Collect Logs:** Gather logs from all relevant components
5. **Contact Support:** Provide detailed logs and error messages

---
Generated by ClusterKit Bootstrap
